jQuery(document).ready((function(a){let e=null,t=!1,r=0;const s=a("#wps3-start-migration"),n=a("#wps3-pause-migration"),o=a("#wps3-reset-migration"),i=a(".wps3-progress-bar"),c=a(".wps3-progress-bar span"),u=a("#wps3-log-container"),p=a(".wps3-migration-stats p");function l(){return t||null!==e}function d(e,t="info"){const r=(new Date).toLocaleTimeString(),s=a("<div>",{class:"wps3-log-entry wps3-log-"+t,text:`[${r}] ${e}`});u.prepend(s)}function f(a,e,t){i.css("width",a+"%").attr({role:"progressbar","aria-valuenow":a,"aria-valuemin":0,"aria-valuemax":100}),c.text(a+"%"),p.text(`Progress: ${e} of ${t} files migrated`)}function g(e=!1){a.ajax({url:wps3_ajax.ajax_url,type:"POST",data:{action:"wps3_start_migration",nonce:wps3_ajax.nonce,reset:e},beforeSend:function(){s.prop("disabled",!0),d("Starting migration...")},success:function(a){a.success?(d(a.data.message),s.hide(),n.show(),w(),_()):(d("Error: "+a.data.message,"error"),s.prop("disabled",!1))},error:function(a,e,t){d("AJAX Error: "+t,"error"),s.prop("disabled",!1)}})}function m(){h(),t=!1,a.ajax({url:wps3_ajax.ajax_url,type:"POST",data:{action:"wps3_get_migration_status",nonce:wps3_ajax.nonce},success:function(e){e.success&&(e.data.migration_running&&a.post(wps3_ajax.ajax_url,{action:"wps3_update_option",nonce:wps3_ajax.nonce,option_name:"wps3_migration_running",option_value:!1}),n.hide(),s.show().prop("disabled",!1),d("Migration paused"))}})}function w(){t||(t=!0,a.ajax({url:wps3_ajax.ajax_url,type:"POST",data:{action:"wps3_process_batch",nonce:wps3_ajax.nonce},success:function(a){t=!1,a.success?(f(a.data.percent_complete,a.data.migrated_files,a.data.total_files),d(a.data.message),a.data.error_count>0&&a.data.errors.forEach((function(a){d(`Failed to migrate ${a.path}: ${a.error}`,"error")})),a.data.complete?(d("Migration complete!","success"),n.hide(),s.show().prop("disabled",!1),h()):setTimeout(w,1e3)):(d("Error: "+a.data.message,"error"),n.hide(),s.show().prop("disabled",!1),h())},error:function(a,e,r){t=!1,d("AJAX Error: "+r,"error"),l()&&setTimeout(w,5e3)}}))}function _(){e=setInterval(j,5e3),r=0}function h(){e&&(clearInterval(e),e=null)}function x(){if(r++,r>=3){d(`Status check failed ${r} times in a row. Pausing status checks.`,"error"),h(),n.hide(),s.show().prop("disabled",!1);const e=a("<div>",{class:"wps3-notification wps3-notification-error",html:'\n                    <p>Status checks have been paused due to repeated failures.</p>\n                    <p>Please check your server connection and try again.</p>\n                    <button class="button button-primary wps3-resume-checks" aria-label="Resume status checks after repeated failures">Resume Status Checks</button>\n                '});u.before(e);const t=a(".wps3-resume-checks");t.focus(),t.on("click",(function(){e.remove(),r=0,_()}))}}function j(){a.ajax({url:wps3_ajax.ajax_url,type:"POST",data:{action:"wps3_get_migration_status",nonce:wps3_ajax.nonce},success:function(a){a.success?(r=0,f(a.data.percent_complete,a.data.migrated_files,a.data.total_files),!a.data.migration_running&&l()&&(n.hide(),s.show().prop("disabled",!1),h())):(d("Status check failed: "+a.data.message,"error"),x())},error:function(a,e,t){d("Status check failed: "+t,"error"),x()}})}s.on("click",(function(){g()})),n.on("click",(function(){m()})),o.on("click",(function(){confirm("Are you sure you want to reset the migration? This will clear all progress and start over.")&&a.ajax({url:wps3_ajax.ajax_url,type:"POST",data:{action:"wps3_reset_migration",nonce:wps3_ajax.nonce},beforeSend:function(){d("Resetting migration...")},success:function(a){a.success?(d(a.data.message,"info"),f(0,0,0),n.hide(),s.show().prop("disabled",!1),h()):d("Error: "+a.data.message,"error")},error:function(a,e,t){d("AJAX Error: "+t,"error")}})})),j()}));
//# sourceMappingURL=admin.js.map